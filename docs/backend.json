{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the AdZone Lanka platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user, matching auth UID.",
          "format": "uuid"
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number used for authentication."
        },
        "membershipId": {
          "type": "string",
          "description": "Reference to the user's active membership."
        },
        "isAdmin": {
          "type": "boolean",
          "description": "Whether the user has administrative privileges."
        }
      },
      "required": [
        "id",
        "phoneNumber"
      ]
    },
    "Ad": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Ad",
      "type": "object",
      "description": "Represents a classified ad posted on the AdZone Lanka platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ad.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who posted the ad."
        },
        "title": {
          "type": "string",
          "description": "Title of the ad."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the ad."
        },
        "imageUrls": {
          "type": "array",
          "description": "URLs of the ad's images stored in Firebase Storage.",
          "items": {
            "type": "string"
          }
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to the ad category."
        },
        "district": {
          "type": "string",
          "description": "The district where the item is located."
        },
        "price": {
            "type": "number",
            "description": "Price of the item being advertised."
        },
        "phoneNumber": {
            "type": "string",
            "description": "Contact phone number for the ad."
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "description",
        "imageUrls",
        "categoryId",
        "district",
        "price",
        "phoneNumber"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for classified ads.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category.",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "description": "Name of the category (e.g., Vehicles, Properties)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Membership": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Membership",
      "type": "object",
      "description": "Represents a user's membership plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the membership.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "The UID of the user who owns this membership."
        },
        "planId": {
          "type": "string",
          "description": "The ID of the plan (e.g., 'silver', 'gold')."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the membership.",
          "format": "date-time"
        },
        "expiryDate": {
          "type": "string",
          "description": "Expiry date of the membership.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the membership (e.g., 'Active', 'Expired', 'Pending')."
        }
      },
      "required": [
        "id",
        "userId",
        "planId",
        "startDate",
        "expiryDate",
        "status"
      ]
    },
    "Banner": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Banner",
      "type": "object",
      "description": "Represents a banner ad.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the banner ad.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "The UID of the user who purchased this banner."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the banner image stored in Firebase Storage."
        },
        "description": {
          "type": "string",
          "description": "Full description of the banner ad."
        },
        "whatsappLink": {
          "type": "string",
          "description": "WhatsApp auto-link for the banner ad."
        },
        "position": {
          "type": "string",
          "description": "Position of the banner ad (Top, Left, Right, Bottom).",
          "enum": ["Top", "Left", "Right", "Bottom"]
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the banner ad.",
          "format": "date-time"
        },
        "expiryDate": {
          "type": "string",
          "description": "Expiry date of the banner ad.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the banner ad (e.g., 'Active', 'Expired', 'Pending')."
        }
      },
      "required": [
        "id",
        "userId",
        "imageUrl",
        "description",
        "whatsappLink",
        "position",
        "startDate",
        "expiryDate",
        "status"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who made the payment."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used (Bank Transfer, eZ Cash, Dialog Genie).",
          "enum": ["Bank Transfer", "eZ Cash", "Dialog Genie"]
        },
        "amount": {
          "type": "number",
          "description": "Payment amount."
        },
        "paymentSlipUrl": {
          "type": "string",
          "description": "URL of the payment slip image stored in Firebase Storage."
        },
        "status": {
          "type": "string",
          "description": "Status of the payment (Pending, Approved, Rejected).",
          "enum": ["Pending", "Approved", "Rejected"]
        },
        "targetId": {
          "type": "string",
          "description": "ID of the item being paid for (e.g., membership plan ID or banner ID)."
        },
        "paymentFor": {
          "type": "string",
          "description": "Type of item being paid for.",
          "enum": ["Membership", "Banner"]
        }
      },
      "required": [
        "id",
        "userId",
        "paymentMethod",
        "amount",
        "paymentSlipUrl",
        "status",
        "targetId",
        "paymentFor"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on an ad.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the comment.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who posted the comment."
        },
        "adId": {
          "type": "string",
          "description": "Reference to the ad the comment belongs to."
        },
        "text": {
          "type": "string",
          "description": "The comment text."
        }
      },
      "required": [
        "id",
        "userId",
        "adId",
        "text"
      ]
    },
    "Like": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Like",
      "type": "object",
      "description": "Represents a like on an ad.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the like.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who liked the ad."
        },
        "adId": {
          "type": "string",
          "description": "Reference to the ad that was liked."
        }
      },
      "required": [
        "id",
        "userId",
        "adId"
      ]
    }
  },
  "auth": {
    "providers": [
      "phone"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Only the authenticated user can access their own document."
        }
      },
      {
        "path": "/ads/{adId}",
        "definition": {
          "entityName": "Ad",
          "schema": {
            "$ref": "#/backend/entities/Ad"
          },
          "description": "Stores ad details. Publicly readable, but only the owner can write."
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores category information. Globally readable and client-side immutable."
        }
      },
      {
        "path": "/memberships/{membershipId}",
        "definition": {
          "entityName": "Membership",
          "schema": {
            "$ref": "#/backend/entities/Membership"
          },
          "description": "Stores membership details. Readable only by the owning user."
        }
      },
      {
        "path": "/banners/{bannerId}",
        "definition": {
          "entityName": "Banner",
          "schema": {
            "$ref": "#/backend/entities/Banner"
          },
          "description": "Stores banner ad details. Globally readable, writes are restricted to admins."
        }
      },
      {
        "path": "/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Stores payment records. Readable only by the owning user."
        }
      },
      {
        "path": "/ads/{adId}/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/backend/entities/Comment"
          },
          "description": "Stores comments for each ad. Publicly readable, writeable by any signed-in user."
        }
      },
      {
        "path": "/ads/{adId}/likes/{likeId}",
        "definition": {
          "entityName": "Like",
          "schema": {
            "$ref": "#/backend/entities/Like"
          },
          "description": "Stores likes for each ad. Publicly readable, only the owner can create/delete their own like."
        }
      }
    ],
    "reasoning": "The data model is structured to support the core features of the AdZone Lanka application, including memberships, banner ads, and various interactions like comments and likes. A key principle is denormalizing the `userId` field into most documents to allow for independent and efficient security rule enforcement without needing expensive `get()` calls. Collections are segregated by data type for clear, maintainable rules. Public content like ads and categories is world-readable, while user-specific data like memberships and payments is private. Write access is strictly controlled, generally limited to the document owner or, in the case of system-level data (categories, banner approvals), disallowed from the client entirely."
  }
}
